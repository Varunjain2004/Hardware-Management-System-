<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Himanshu Hardware - Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="form-page">
        <div class="nav-bar">
            <h1>Himanshu Hardware - Admin</h1>
            <div class="nav-links">
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="products.html">Products</a>
                <a href="orders.html">Orders</a>
                <a href="customers.html">Customers</a>
                <a href="login.html" id="logoutBtn">Logout</a>
            </div>
        </div>
        
        <div class="main-container">
            <h2>Admin Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Products</h3>
                    <div class="stat-number" id="totalProducts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Orders</h3>
                    <div class="stat-number" id="totalOrders">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Customers</h3>
                    <div class="stat-number" id="totalCustomers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Revenue</h3>
                    <div class="stat-number" id="totalRevenue">₹0</div>
                </div>
            </div>
            
            <div class="admin-sections">
                <div class="section">
                    <h3>Recent Orders</h3>
                    <div id="recentOrders" class="recent-orders">
                        <!-- Recent orders will be displayed here -->
                    </div>
                </div>
                
                <div class="section">
                    <h3>Quick Actions</h3>
                    <div class="quick-actions">
                        <button onclick="addNewProduct()" class="action-btn">Add New Product</button>
                        <button onclick="viewAllOrders()" class="action-btn">View All Orders</button>
                        <button onclick="manageCustomers()" class="action-btn">Manage Customers</button>
                        <button onclick="generateReport()" class="action-btn">Generate Report</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal hidden">
        <div class="modal-content">
            <h3>Add New Product</h3>
            <form id="addProductForm">
                <input type="text" id="productName" placeholder="Product Name" required>
                <select id="productCategory" required>
                    <option value="">Select Category</option>
                    <option value="tools">Tools</option>
                    <option value="electrical">Electrical</option>
                    <option value="plumbing">Plumbing</option>
                    <option value="paint">Paint</option>
                </select>
                <input type="number" id="productPrice" placeholder="Price" required>
                <input type="number" id="productStock" placeholder="Stock Quantity" required>
                <textarea id="productDescription" placeholder="Description" rows="3"></textarea>
                <input type="text" id="productImage" placeholder="Image URL">
                <div class="form-buttons">
                    <button type="submit" class="submit-btn">Add Product</button>
                    <button type="button" onclick="closeModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];

        function loadDashboard() {
            updateStats();
            displayRecentOrders();
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('totalCustomers').textContent = customers.length;
            
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('totalRevenue').textContent = '₹' + totalRevenue;
        }

        function displayRecentOrders() {
            const recentOrders = document.getElementById('recentOrders');
            const recent = orders.slice(-5).reverse(); // Last 5 orders
            
            if (recent.length === 0) {
                recentOrders.innerHTML = '<p>No orders yet</p>';
                return;
            }
            
            recentOrders.innerHTML = recent.map(order => `
                <div class="order-item">
                    <div class="order-info">
                        <strong>Order #${order.id}</strong>
                        <span>${order.customer.fullName || order.customer.username}</span>
                        <span>₹${order.total}</span>
                    </div>
                    <div class="order-date">
                        ${new Date(order.orderDate).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function addNewProduct() {
            document.getElementById('addProductModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('addProductModal').classList.add('hidden');
        }

        function addProduct() {
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const description = document.getElementById('productDescription').value;
            const image = document.getElementById('productImage').value || `https://via.placeholder.com/200x150/0077b6/ffffff?text=${name}`;
            
            const newProduct = {
                id: Date.now(),
                name,
                category,
                price,
                stock,
                description,
                image
            };
            
            products.push(newProduct);
            localStorage.setItem('products', JSON.stringify(products));
            
            closeModal();
            loadDashboard();
            
            // Clear form
            document.getElementById('addProductForm').reset();
            
            alert('Product added successfully!');
        }

        function viewAllOrders() {
            window.location.href = 'orders.html';
        }

        function manageCustomers() {
            window.location.href = 'customers.html';
        }

        function generateReport() {
            const reportContent = `
HIMANSHU HARDWARE - ADMIN REPORT
================================

Generated on: ${new Date().toLocaleDateString()}

Summary:
- Total Products: ${products.length}
- Total Orders: ${orders.length}
- Total Customers: ${customers.length}
- Total Revenue: ₹${orders.reduce((sum, order) => sum + order.total, 0)}

Recent Orders:
${orders.slice(-10).reverse().map(order => 
    `Order #${order.id} - ${order.customer.fullName || order.customer.username} - ₹${order.total}`
).join('\n')}

Top Products:
${getTopProducts()}

================================
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `admin_report_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function getTopProducts() {
            const productSales = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    if (productSales[item.name]) {
                        productSales[item.name] += item.quantity;
                    } else {
                        productSales[item.name] = item.quantity;
                    }
                });
            });
            
            return Object.entries(productSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([name, quantity]) => `${name}: ${quantity} units`)
                .join('\n');
        }

        // Event listeners
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addProduct();
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('currentUser');
        });

        // Initialize dashboard
        loadDashboard();

        // Check if user is logged in and is admin
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.role !== 'admin') {
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
